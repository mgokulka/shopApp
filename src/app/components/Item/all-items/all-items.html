<div class="card">
  <p-toast />
  <p-toolbar class="mb-6">
    <ng-template #start>
      <p-button
        label="New"
        icon="pi pi-plus"
        class="mr-2"
        (onClick)="openNew()"
      />

      <p-iconfield>
        <p-inputicon class="pi pi-search" />
        <input pInputText type="text" placeholder="Search..." />
      </p-iconfield>
    </ng-template>

    <ng-template #end>
      <p-fileUpload
        mode="basic"
        accept="image/*"
        [maxFileSize]="1000000"
        label="Import"
        chooseLabel="Import"
        auto
        customUpload
        class="mr-2 inline-block"
        [chooseButtonProps]="{ severity: 'secondary' }"
      />
      <p-button label="Export" icon="pi pi-upload" severity="secondary" />
    </ng-template>
  </p-toolbar>

  <p-table
    #dt
    [value]="products"
    [rows]="10"
    reorderableColumn="true"
    [columns]="cols"
    [paginator]="true"
    [globalFilterFields]="['product.name', 'brand', 'barcode', 'sellingPrice']"
    [tableStyle]="{ 'min-width': '75rem' }"
    [(selection)]="selectedProduct"
    (onRowSelect)="editProduct($event.data)"
    [rowHover]="true"
    selectionMode="single"
    dataKey="id"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [showCurrentPageReport]="true"
    [responsiveLayout]="'scroll'"
  >
    <!-- Table Header -->
    <ng-template #header>
      <tr>
        <th style="min-width: 8rem">Barcode</th>
        <th pSortableColumn="name" style="min-width: 8rem">
          <div class="flex items-center gap-2">
            Name
            <p-sortIcon field="name" />
          </div>
        </th>
        <th pSortableColumn="brand" style="min-width: 8rem">
          <div class="flex items-center gap-2">
            Brand
            <p-sortIcon field="brand" />
          </div>
        </th>
        <th pSortableColumn="category" style="min-width: 8rem">
          <div class="flex items-center gap-2">
            Category
            <p-sortIcon field="category" />
          </div>
        </th>
        <th pSortableColumn="color" style="min-width: 8rem">
          <div class="flex items-center gap-2">
            Color
            <p-sortIcon field="color" />
          </div>
        </th>
        <th>Image</th>
        <th pSortableColumn="rating" style="min-width: 12rem">
          <div class="flex items-center gap-2">
            Selling Price
            <p-sortIcon field="rating" />
          </div>
        </th>
        <th pSortableColumn="inventoryStatus" style="min-width: 12rem">
          <div class="flex items-center gap-2">
            Cost Price
            <p-sortIcon field="inventoryStatus" />
          </div>
        </th>
        <th pSortableColumn="lowStockAlert" style="min-width: 12rem">
          <div class="flex items-center gap-2">
            Low Stock Alert
            <p-sortIcon field="lowStockAlert" />
          </div>
        </th>
        <th pSortableColumn="sizes" style="min-width: 12rem">
          <div class="flex items-center gap-2">
            Sizes
            <p-sortIcon field="sizes" />
          </div>
        </th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template #body let-product let-rowIndex="rowIndex">
      <tr [pSelectableRow]="product">
        <td>{{ product.barcode }}</td>
        <td>{{ product.name }}</td>
        <td>{{ product.brand }}</td>
        <td>{{ product.category }}</td>
        <td>
          <p-colorPicker
            [ngModel]="product.color"
            styleClass="w-100"
            [style]="{ height: '2.5rem' }"
          ></p-colorPicker>
        </td>
        <td>
          <img
            [src]="product.imageUrl"
            [alt]="product.name"
            style="width: 64px"
            class="rounded"
          />
        </td>
        <td>{{ product.sellingPrice | currency : "INR" }}</td>
        <td>{{ product.costPrice | currency : "INR" }}</td>
        <td>
          <p-tag
            [value]="product.lowStockAlert"
            [severity]="getSeverity(product)"
          />
        </td>
        <td>
          @for(size of product.sizes; track $index){
          <p-chip class="!py-0 !pl-0 !pr-4">
            <span
              class="bg-primary border-circle rounded-pill px-2 text-primary-contrast rounded-full w-8 h-8 flex items-center justify-center"
            >
              {{ size.size }}
            </span>
            <span class="ml-2 font-medium"> {{ size.quantity }} </span>
          </p-chip>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog
    [(visible)]="productDialog"
    [style]="{ width: '60vw' }"
    [header]="dialogHeader.title"
    [modal]="true"
    (onHide)="closeProductDialog()"
  >
    <ng-template #content>
      <app-create-item
        [currentProduct]="selectedProduct"
        (closePopup)="closeProductDialog()"
      ></app-create-item>
    </ng-template>

    <ng-template #footer>
      <!-- <p-button label="Cancel" icon="pi pi-times" text (click)="hideDialog()" />
      <p-button label="Save" icon="pi pi-check" /> -->
      @if(dialogHeader.showDelete){
      <p-button
        icon="pi pi-trash"
        severity="danger"
        [rounded]="true"
        [outlined]="true"
        (click)="deleteProduct(selectedProduct)"
      />
      }
    </ng-template>
  </p-dialog>

  <p-confirmDialog [style]="{ width: '450px' }" />
</div>
